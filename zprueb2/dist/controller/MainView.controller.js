sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/base/Log"],(e,t,a)=>{"use strict";return e.extend("zprueb2.controller.MainView",{onInit:function(){const e=new t({items:[]});e.setSizeLimit(15e5);this.getView().setModel(e,"localModel");this._loadDataFromAPI()},_loadDataFromAPI:function(){const e="https://api-ngcnd.azurewebsites.net/api/sapdata";const t=this.getView().getModel("localModel");this.getView().setBusy(true);fetch("https://api-ngcnd.azurewebsites.net/api/sapdata").then(e=>e.json()).then(e=>{console.log(e);this._processData(e);t.setProperty("/items",e)}).catch(e=>{a.error("Fallo la carga de datos del API",e)}).finally(()=>{this.getView().setBusy(false)})},_processData:function(e){e.forEach(e=>{let t=e.Iva;let a=this._getPercentage(t);if(e.SubTotal!==undefined){let t=(parseFloat(e.SubTotal)*a).toFixed(2);e.CalculatedTotal=t;e.Match=parseFloat(t)===parseFloat(e.SubTotal)}else{e.CalculatedTotal="N/A";e.Match=false}})},_getPercentage:function(e){const t={BS3:1.1,VS1:1.2,VS2:1.4};return t[e]||1},onSearch:function(e){const t=e.getParameter("query");const a=this.getView().byId("reporteTable");const s=a.getBinding("items");if(t){const e=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("TABNAME",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("DDTEXT",sap.ui.model.FilterOperator.Contains,t)],and:false});s.filter(e)}else{s.filter([])}}})});
//# sourceMappingURL=MainView.controller.js.map